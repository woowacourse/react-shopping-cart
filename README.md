### ✅ 기능 요구사항

1️⃣ 상태 설계

- 상품 정보, 수량, 선택 여부, 쿠폰 등 핵심 상태는 하나의 원천 상태(Single Source of Truth)로 관리
- 결제 금액, 할인 금액, 배송비 등은 이 상태로부터 **파생된 값**으로 계산하여 처리

2️⃣ 쿠폰 기능 구현

- 다음 4가지 쿠폰을 사용할 수 있어야 하며, 각각의 **조건과 효과에 맞는 할인 금액을 파생 상태로 계산**해야 한다.

1. **5,000원 할인 쿠폰 (FIXED5000)**
   - 최소 주문 금액: 100,000원
   - 할인 금액: 5,000원
   - 만료일: 2025-11-30
2. **2+1 쿠폰 (BOGO)**
   - 동일 상품 2개 구매 시 1개 무료
   - 여러 상품이 해당되면 **단가가 가장 높은 상품에 적용**
   - 만료일: 2025-06-30
3. **무료 배송 쿠폰 (FREESHIPPING)**
   - 최소 주문 금액: 50,000원
   - 도서 및 산간 지역 포함
   - 만료일: 2025-08-31
4. **30% 시간제 할인 쿠폰 (MIRACLESALE)**
   - 할인율: 30%
   - 적용 시간: 오전 4시 ~ 7시
   - 만료일: 2025-07-31

- 금액을 계산할 때는 주문 금액(쿠폰 적용 전)과 최종 결제 금액(쿠폰 적용 후)으로 나누어서 구분
- 주문 금액이 10만원이어서 무료 배송 혜택을 받은 상황에서 미라클 모닝 쿠폰으로 할인을 받아 7만원이 되어도 무료 배송 혜택이 그대로 적용 가능하다.

> 💡 예: 주문 금액이 10만 원이라 무료 배송이 적용된 상태에서,
> 미라클 모닝 쿠폰으로 결제 금액이 7만 원이 되더라도 **무료 배송은 유지**된다.

3️⃣ 쿠폰 복합 적용

- 한 번에 **최대 2개의 쿠폰**을 사용할 수 있어야 한다.
- 적용 순서에 따라 할인 금액이 달라질 수 있으므로, **가장 할인 효과가 큰 조합을 자동으로 선택**해야 한다.

4️⃣ 배송비 정책

- 쿠폰 적용 후 결제 금액과 무관하게, 주문 금액(쿠폰 적용 전)이 100,000원 이상이면 **무료 배송** 혜택이 적용된다.
- “제주도 및 도서 산간 지역” 체크 시 **배송비 3,000원 추가**한다.
- FREESHIPPING 쿠폰은 **도서산간 추가 배송비까지 포함하여 무료 처리**해야 한다.
