# 🚀 장바구니

## 📍 2단계 학습 목표

✔️ 상태를 중복 없이 구성하고, 계산이 가능한 값은 파생 상태로 도출하여 관리할 수 있다.

✔️ 함수(컴포넌트, 훅, util)가 단일한 책임만 갖도록 분리하고, 그 책임에 맞는 명확한 인터페이스를 정의할 수 있다.

## 🎯 2단계 기능 요구 사항

### 1. 상태 설계

- [ ] 상품 정보, 수량, 선택 여부, 쿠폰 등 핵심 상태는 하나의 원천 상태(Single Source of Truth)로 관리해야 한다.
- [ ] 결제 금액, 할인 금액, 배송비 등은 이 상태로부터 파생된 값으로 계산하여 처리한다.

### 2. 쿠폰 기능 구현

- [ ] 다음 4가지 쿠폰을 사용할 수 있어야 하며, 각각의 조건과 효과에 맞는 할인 금액을 파생 상태로 계산해야 한다.
- [ ] 금액을 계산할 때는 주문 금액(쿠폰 적용 전)과 최종 결제 금액(쿠폰 적용 후)으로 나누어서 구분한다.
- [ ] 주문 금액이 10만원이어서 무료 배송 혜택을 받은 상황에서 미라클 모닝 쿠폰으로 할인을 받아 7만원이 되어도 무료 배송 혜택이 그대로 적용 가능하다.
  - [ ] 💡 예: 주문 금액이 10만 원이라 무료 배송이 적용된 상태에서, 미라클 모닝 쿠폰으로 결제 금액이 7만 원이 되더라도 무료 배송은 유지된다.

#### 쿠폰 목록

- [ ] 5,000원 할인 쿠폰 (FIXED5000)
  - [ ] 최소 주문 금액: 100,000원
  - [ ] 할인 금액: 5,000원
  - [ ] 만료일: 2025-11-30
- [ ] 1+1 쿠폰 (BOGO)
  - [ ] 동일 상품 3개 구매 시 1개 무료
  - [ ] 여러 상품이 해당되면 단가가 가장 높은 상품에 적용
  - [ ] 만료일: 2025-06-30
- [ ] 무료 배송 쿠폰 (FREESHIPPING)
  - [ ] 최소 주문 금액: 50,000원
  - [ ] 도서 및 산간 지역 포함
  - [ ] 만료일: 2025-08-31
- [ ] 30% 시간제 할인 쿠폰 (MIRACLESALE)
  - [ ] 할인율: 30%
  - [ ] 적용 시간: 오전 4시 ~ 7시
  - [ ] 만료일: 2025-07-31

### 3. 쿠폰 복합 적용

- [ ] 한 번에 최대 2개의 쿠폰을 사용할 수 있어야 한다.
- [ ] 적용 순서에 따라 할인 금액이 달라질 수 있으므로, 가장 할인 효과가 큰 조합을 자동으로 선택해야 한다.

### 4. 배송비 정책

- [x] 쿠폰 적용 후 결제 금액과 무관하게, 주문 금액(쿠폰 적용 전)이 100,000원 이상이면 무료 배송 혜택이 적용된다.
- [x] “제주도 및 도서 산간 지역” 체크 시 배송비 3,000원 추가한다.
- [ ] FREESHIPPING 쿠폰은 도서산간 추가 배송비까지 포함하여 무료 처리해야 한다.

## ✅ 2단계 프로그래밍 요구사항

### 상태 관리

- [ ] React의 상태 관리 훅(useState, useReducer)을 사용하여 상태를 구성하고, 필요 시에 Context API 등을 활용해 해당 상태가 필요한 컴포넌트 트리에 상태를 전달한다.

### 역할과 책임

- [ ] 단일 책임 원칙
  - [ ] 컴포넌트/훅을 잘게 나누고, 각 함수가 하나의 책임만 가지고 있는지 점검한다.
  - [ ] 컴포넌트는 UI 표현만 담당하며, 상태 관리 로직이나 파생 상태 계산 로직(e.g. 쿠폰 적용 금액 계산)을 포함하지 않아야 한다.
  - [ ] 동일한 값에 대한 계산(e.g. 할인 금액, 배송비 등)은 항상 한 곳에서만 수행되도록 하여 같은, 중복된 책임이 발생하지 않도록 한다.
- [ ] 책임 중심 인터페이스
  - [ ] 컴포넌트/함수의 인터페이스는 구현에 따라 달라지는 것이 아니라, 책임에 맞게 설계한다. 구현 하기 전에 인터페이스를 먼저 구성하여, 책임을 명확히 한다.
  - [ ] 커스텀 훅을 만들기 전, UI가 어떤 데이터와 동작을 필요로 하는지 인터페이스를 먼저 설계해본다.
  - [ ] 훅의 반환값은 UI에 필요한 최소한의 정보만 포함하고, 내부 구현은 외부에 드러나지 않도록 캡슐화한다.
- [ ] 모달
  - [ ] 쿠폰 코드를 입력하기 위한 모달창은 이전 미션에서 만든 모달 컴포넌트 라이브러리를 그대로 사용하여도 무방하다.
- [ ] API
  - [ ] /coupons API를 호출하여 쿠폰 목록을 불러오고 적용한다.
- [ ] 테스트
  - [ ] 쿠폰 적용에 따른 다양한 시나리오에 대한 테스트를 작성한다.
    - [ ] 시간 조건에 따라 적용 여부가 달라지는 미라클 모닝 쿠폰 적용 케이스도 테스트 가능한 방법을 고민한다.
    - [ ] 시간, 지역, 주문 금액 등 복잡한 쿠폰 적용 조건에 대해 경계값 테스트를 작성한다.
    - [ ] 가장 큰 할인 조합이 적용되는지를 확인하는 테스트를 작성한다.
  - [ ] 단일한 책임을 가진 순수함수를 작성하여, 테스트 하기 쉽게 만든다.
    - [ ] 쿠폰 계산 로직은 가능한 한 순수 함수로 작성하고, 컴포넌트나 훅 외부로 분리하여 테스트 하기 쉽게 만든다.
- [x] localStorage
  - [x] 장바구니 선택 상태를 로컬스토리지에 저장하여 새로고침 시에도 유지되도록 한다.

## 📍 1단계 학습 목표

✔️ 클라이언트 상태를 효과적으로 모델링하고 관리할 수 있다.

✔️ Jest, React Testing Library(RTL)를 활용하여 주요 기능에 대한 테스트를 작성할 수 있다.

## 🎯 1단계 기능 요구 사항

- [x] **`/cart-items`** API를 호출하여 장바구니 상품 데이터를 불러온다.
- [x] 불러온 데이터를 기반으로 클라이언트 상태를 구성하고 관리한다.
  - [x] 개별 상품의 선택 여부, 결제 금액, 배송비 등의 상태를 관리한다.
- [x] 상품 선택에 따른 결제 금액, 배송비 등의 동적인 변경 사항을 처리한다.
  - [x] 진입 시, 전체 선택 되어 있는 것이 디폴트이다.
  - [x] 상품 선택/해제 시 결제 금액을 동적으로 변경한다.
  - [x] 결제 금액이 10만원 이상일 경우 배송비는 무료이다.
- [x] 장바구니 상품의 수량을 변경할 수 있다.
- [x] 장바구니에 담긴 상품을 제거할 수 있다.

## ✅ 1단계 프로그래밍 요구사항

### State Management

- [x] React의 상태 관리 훅(useState, useReducer)을 사용하여 상태를 구성하고, 필요 시에 Context API 등을 활용해 해당 상태가 필요한 컴포넌트 트리에 상태를 전달한다.
- [x] 결제 금액, 배송비 등의 파생 상태(Derived State)를 동적으로 계산한다.

### Test

- [x] Vitest, React Testing Library를 사용하여 주요 기능에 대한 테스트 케이스를 작성한다.

  - [x] Vitest

    - [x] 주문 금액·배송비·결제 금액 계산 로직
      - [x] 상품 금액 합산
      - [x] 배송비 10만원 이상이면 0원 적용
      - [x] 총 결제 금액 합산

  - [x] RTL
    - [x] 장바구니 아이템 UI 렌더링
      - [x] 로딩된 아이템이 화면에 잘 보이는지
    - [x] 페이지 진입 시 모든 체크박스가 체크된 상태
    - [x] 장바구니에서 상품 제거 UI
      - [x] ‘삭제’ 버튼 클릭 → 해당 아이템이 DOM에서 사라지는지
    - [x] 수량 변경 UI
      - [x] +/- 또는 직접 입력 → 화면에 표시된 수량 & 금액이 업데이트되는지
    - [x] 상품 선택/해제 UI
      - [x] 체크박스 클릭 → 금액(주문금액, 배송비, 결제금액)이 화면에 재계산되어 반영되는지
    - [x] 결제 금액 10만원 이상 시 배송비 “0원” UI 반영
    - [x] 선택된 상품 없을 때 주문 확인 버튼 비활성화
    - [x] 주문 확인 페이지 렌더링
      - [x] 상품 종류 수, 총 개수, 결제 금액이 제대로 표시되는지

### Routing

- [x] react-router를 이용하여 페이지를 관리한다.

### Library

- 스타일링 : emotion
- **명시된 라이브러리 외에는 사용하지 않고 직접 구현한다.**
